From 52437ea3f86eb53aa80ada48c9101f98675ba69f Mon Sep 17 00:00:00 2001
From: SeongJae Park <sjpark@amazon.de>
Date: Tue, 23 Nov 2021 14:02:17 +0000
Subject: Revert "mm/damon: needn't hold kdamond_lock to print pid of kdamond"

This reverts commit f80af32bccfa1c643abacd4a95c9eb7db9472695.
---
 mm/damon/core.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/mm/damon/core.c b/mm/damon/core.c
index c3bea54e78b0..39069aa0d80b 100644
--- a/mm/damon/core.c
+++ b/mm/damon/core.c
@@ -647,7 +647,9 @@ static int kdamond_fn(void *data)
 	unsigned int max_nr_accesses = 0;
 	unsigned long sz_limit = 0;
 
-	pr_debug("kdamond (%d) starts\n", current->pid);
+	mutex_lock(&ctx->kdamond_lock);
+	pr_debug("kdamond (%d) starts\n", ctx->kdamond->pid);
+	mutex_unlock(&ctx->kdamond_lock);
 
 	if (ctx->primitive.init)
 		ctx->primitive.init(ctx);
@@ -698,7 +700,7 @@ static int kdamond_fn(void *data)
 	if (ctx->primitive.cleanup)
 		ctx->primitive.cleanup(ctx);
 
-	pr_debug("kdamond (%d) finishes\n", current->pid);
+	pr_debug("kdamond (%d) finishes\n", ctx->kdamond->pid);
 	mutex_lock(&ctx->kdamond_lock);
 	ctx->kdamond = NULL;
 	mutex_unlock(&ctx->kdamond_lock);
-- 
2.32.0

